<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>&lt;shacl-form&gt; demo</title>
  <link rel="stylesheet" href="./style.css">
    <!-- "shacl-form": "https://cdn.jsdelivr.net/npm/@ulb-darmstadt/shacl-form/dist/index-with-plugins.js" -->
    <script type="importmap">
    {
      "imports": {
        "shacl-form": "./index-with-plugins.js"
      }
    }
  </script>
  <script type="module">
    import 'shacl-form'
  </script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/styles/dark.min.css">
  <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/highlight.min.js"></script>
</head>

<body>
  <div class="header">
    <h1>&lt;shacl-form&gt; demo</h1>
  </div>
  <div class="menu">
    <a id="intro" href="#intro">Basic usage</a>
    <a id="datatypes" href="#datatypes">Data types</a>
    <a id="complex-example" href="#complex-example">Complex example</a>
    <a id="try-your-own" href="#try-your-own">Try your own</a>
  </div>
  <div class="main">
    <div class="content" id="content">Loading...</div>
    <div class="footer">
      <a href="https://github.com/ULB-Darmstadt/shacl-form"><img alt="GitHub Logotype" src="./github-mark.png" height="64"></a>
      <a href="https://www.npmjs.com/package/@ulb-darmstadt/shacl-form">
        <img src="https://img.shields.io/npm/v/@ulb-darmstadt/shacl-form.svg" alt="Version">
      </a>
    </div>
  </div>
  <script>
    const main = document.querySelector('.main')
    // listen on the whole document; you could restrict this to an element though
    document.querySelector('.menu').addEventListener('wheel', (event) => {
      main.scrollTop += event.deltaY;
    })
    window.addEventListener('hashchange', (ev) => {
      ev.preventDefault()
      const parent = document.getElementById('content')
      parent.classList.add('loading')
    
      const hash = window.location.hash.substring(1)
      if (hash) {
        setTimeout(() => {
          parent.replaceChildren()
          parent.appendChild(document.getElementById('template-'+hash).content.cloneNode(true))
          hljs.highlightAll()
          parent.classList.remove('loading')
        }, 300)
      } else {
        document.querySelector('.menu a')?.click()
      }
      return false
    })
    window.dispatchEvent(new Event('hashchange'))
  </script>

  <template id="template-intro">
    <p>
      <a href="https://github.com/ULB-Darmstadt/shacl-form">&lt;shacl-form&gt;</a> is an HTML5 web component that takes <a href="https://www.w3.org/TR/shacl/">SHACL shapes</a> as input and generates an HTML form, allowing to enter data that conform to the given shapes.
      See the <a href="https://github.com/ULB-Darmstadt/shacl-form">README</a> for the documentation of all element attributes, functions and supported input/output RDF formats.
    </p>
    <p>Here's a basic usage example:</p>
    <pre>
        <code>
&lt;html&gt;
  &lt;head&gt;
      &lt;script src="https://cdn.jsdelivr.net/npm/@ulb-darmstadt/shacl-form/dist/index.js" type="module"&gt;&lt;/script&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;!-- SHACL shapes can be defined on the attribute 'data-shapes' or can be loaded by setting attribute 'data-shapes-url' --&gt;
    &lt;shacl-form data-shapes="
      @prefix sh: &lt;http://www.w3.org/ns/shacl#&gt; .
      @prefix ex: &lt;http://example.org#&gt; .

      ex:ExampleShape
        a sh:NodeShape ;
        sh:property [
          sh:name 'my value' ;
          sh:path ex:exampleValue ;
          sh:maxCount 3 ;
        ] .
    "&gt;&lt;/shacl-form&gt;

    &lt;script&gt;
      const form = document.querySelector("shacl-form")
      form.addEventListener('change', event => {
        // check if form validates according to the SHACL shapes
        if (event.detail?.valid) {
          // get data graph as RDF triples (default format is 'text/turtle') and log them to the browser console
          const triples = form.serialize() 
          console.log('entered form data', triples)
          // store the data somewhere, e.g. in a triple store
        }
      })
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
        </code>
    </pre>
    <fieldset>
      <legend>Result of the above</legend>
      <shacl-form data-shapes="
        @prefix sh: <http://www.w3.org/ns/shacl#> .
        @prefix ex: <http://example.org#> .

        ex:ExampleShape
          a sh:NodeShape ;
          sh:property [
            sh:name 'my value' ;
            sh:path ex:exampleValue ;
            sh:maxCount 3 ;
          ] .
      "></shacl-form>

      <script>
        setTimeout(() => {
          const form = document.querySelector("shacl-form")
          form.addEventListener('change', event => {
            // check if form validates according to the SHACL shapes
            if (event.detail?.valid) {
              // get data graph as RDF triples and log them to the browser console
              const triples = form.serialize() 
              console.log('entered form data', triples)
              // store the data somewhere, e.g. in a triple store
            }
          })
        })
      </script>
    </fieldset>
  </template>

  <template id="template-datatypes">
    <p>
      <span class="code">sh:datatype</span>s are mapped to corresponding HTML input elements, including constraints like <span class="code">sh:minInclusive</span>, <span class="code">sh:minExclusive</span>, <span class="code">sh:maxInclusive</span>, <span class="code">sh:maxExclusive</span> and <span class="code">sh:pattern</span>.
    </p>
    <p>Note that you can affect the display order of the input elements with <span class="code">sh:order</span> or group elements using <span class="code">sh:group</span>.</p>

    <div class="wrapper">
      <fieldset><legend>SHACL shapes as input to the form</legend><pre id="shacl-shape-input"></pre></fieldset>
      <fieldset><legend>Generated form</legend><shacl-form id="shacl-form"></shacl-form></fieldset>
      <fieldset id="shacl-output"><legend>Output generated by the form</legend><pre></pre></fieldset>
    </div>
    <script>
      setTimeout(() => {
        const form = document.getElementById("shacl-form")
        const shapes = document.getElementById("shacl-shape-input")
        const output = document.getElementById("shacl-output")
        form.addEventListener('change', (ev) => {
          output.classList.toggle('valid', ev.detail?.valid)
          output.classList.toggle('invalid', !ev.detail?.valid)
          output.querySelector("pre").innerText = form.serialize()
        })
        fetch("datatypes.ttl").then(resp => resp.text()).then((text) => {
          shapes.innerText = text
          form.dataset['shapes'] = text
        })
      })
    </script>
  </template>
  
  <template id="template-complex-example">
    <p>This is a more complex example, demonstrating the more advanced features. See below for an explanation.</p>
    <div class="wrapper">
      <fieldset><legend>SHACL shapes as input to the form</legend><pre id="shacl-shape-input"></pre></fieldset>
      <fieldset><legend>Data graph as input to the form</legend><pre id="shacl-data-input"></pre></fieldset>
      <fieldset><legend>Generated form</legend><shacl-form id="shacl-form" data-submit-button data-value-subject="http://example.org/4f2a8de3-9fc8-40a9-9237-d5964520ec54"></shacl-form></fieldset>
    </div>
    <fieldset id="shacl-output" class="mt-1"><legend>Output generated by the form</legend><pre></pre></fieldset>
    <script type="module">
      import { MapBoxPlugin } from 'shacl-form'
      setTimeout(async () => {
        const form = document.getElementById("shacl-form")
        form.registerPlugin(new MapBoxPlugin({ datatype: 'http://www.opengis.net/ont/geosparql#wktLiteral' }, 'pk.eyJ1IjoiaHViZXJtb3NlciIsImEiOiJja3c2NDI2MXAwbWx0MnVudnJiOGV6NjRqIn0.va4IWkUk-USoL2Z8FylNzA'))

        const shapes = document.getElementById("shacl-shape-input")
        const data = document.getElementById("shacl-data-input")
        const output = document.getElementById("shacl-output")
        form.addEventListener('change', (ev) => {
          output.classList.toggle('valid', ev.detail?.valid)
          output.classList.toggle('invalid', !ev.detail?.valid)
          output.querySelector("pre").innerText = form.serialize()
        })
        form.addEventListener('submit', (ev) => {
          output.classList.add('valid')
          output.classList.remove('invalid')
          output.querySelector("pre").innerText = form.serialize()
        })
        form.setClassInstanceProvider((clazz) => { 
          if (clazz === 'http://example.org/Material') {
            return `
              <http://example.org/steel> a <http://example.org/Material>; <http://www.w3.org/2000/01/rdf-schema#label> "Steel".
              <http://example.org/wood> a <http://example.org/Material>; <http://www.w3.org/2000/01/rdf-schema#label> "Wood".
              <http://example.org/alloy> a <http://example.org/Material>; <http://www.w3.org/2000/01/rdf-schema#label> "Alloy".
            `
          }
        })
        const shapesTTL = await fetch("complex-example.ttl").then(resp => resp.text())
        const dataTTL = await fetch("complex-example-data.ttl").then(resp => resp.text())
        shapes.innerText = shapesTTL
        data.innerText = dataTTL
        form.dataset['shapes'] = shapesTTL
        form.dataset['values'] = dataTTL
      })
    </script>
    <p>The above uses the following features:</p>
    <h1>SHACL shape inheritance</h1>
    <p></p>
    <h1>Providing external data to the shapes graph</h1>
    <p>taxonomies (owl:import, classInstanceProvider)</p>
    <h1>Binding a data graph to the form</h1>
    <p></p>
    <h1>SHACL "or" constraint</h1>
    <p></p>
    <h1>Plugins</h1>
    <p></p>
shacl groups
lang strings (languageIn)

  </template>

  <template id="template-try-your-own">
    <div class="wrapper">
      <fieldset><legend>Enter your SHACL shapes here</legend><textarea id="shacl-shape-input" class="w-100 h-100"></textarea></fieldset>
      <fieldset><legend>Generated form</legend><shacl-form id="shacl-form"></shacl-form></fieldset>
      <fieldset id="shacl-output"><legend>Output generated by the form</legend><pre></pre></fieldset>
    </div>
    <script>
      setTimeout(() => {
        const form = document.getElementById("shacl-form")
        const shapes = document.getElementById("shacl-shape-input")
        const output = document.getElementById("shacl-output")
        shapes.addEventListener('change', () => {
          form.dataset['shapes'] = shapes.value
          output.querySelector("pre").innerText = ''
          output.classList.remove('valid', 'invalid')
        })
        form.addEventListener('change', (ev) => {
          output.classList.toggle('valid', ev.detail?.valid)
          output.classList.toggle('invalid', !ev.detail?.valid)
          output.querySelector("pre").innerText = form.serialize()
        })
      })
    </script>
  </template>
</body>
</html>
