<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>&lt;shacl-form&gt; demo</title>
  <link rel="stylesheet" href="./style.css">
    <!-- "@ulb-darmstadt/shacl-form": "https://cdn.jsdelivr.net/npm/@ulb-darmstadt/shacl-form/dist/" -->
    <!-- "@ulb-darmstadt/shacl-form": "./" -->
    <script type="importmap">
    {
      "imports": {
        "@ulb-darmstadt/shacl-form/": "https://cdn.jsdelivr.net/npm/@ulb-darmstadt/shacl-form/dist/"
      }
    }
  </script>
  <script type="module">
    import '@ulb-darmstadt/shacl-form/index.js'
  </script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/styles/dark.min.css">
  <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/highlight.min.js"></script>
</head>

<body>
  <div class="header">
    <h1>&lt;shacl-form&gt; demo</h1>
  </div>
  <div class="menu">
    <a id="intro" href="#intro">Basic usage</a>
    <a id="datatypes" href="#datatypes">Data types</a>
    <a id="complex-example" href="#complex-example">Complex example</a>
    <a id="viewer-mode" href="#viewer-mode">Viewer mode</a>
    <a id="theming" href="#theming">Theming</a>
    <a id="try-your-own" href="#try-your-own">Try your own</a>
  </div>
  <div class="main">
    <div class="content" id="content">Loading...</div>
    <div class="footer">
      <a href="https://github.com/ULB-Darmstadt/shacl-form"><img alt="GitHub Logotype" src="./github-mark.png" height="64"></a>
      <a href="https://www.npmjs.com/package/@ulb-darmstadt/shacl-form">
        <img src="https://img.shields.io/npm/v/@ulb-darmstadt/shacl-form.svg" alt="Version">
      </a>
    </div>
  </div>
  <script>
    const main = document.querySelector('.main')
    // listen on the whole document; you could restrict this to an element though
    document.querySelector('.menu').addEventListener('wheel', (event) => {
      main.scrollTop += event.deltaY;
    })
    window.addEventListener('hashchange', (ev) => {
      ev.preventDefault()
      const parent = document.getElementById('content')
      parent.classList.add('loading')
    
      const hash = window.location.hash.substring(1)
      if (hash) {
        setTimeout(() => {
          parent.replaceChildren()
          parent.appendChild(document.getElementById('template-'+hash).content.cloneNode(true))
          hljs.highlightAll()
          parent.classList.remove('loading')
        }, 300)
      } else {
        document.querySelector('.menu a')?.click()
      }
      return false
    })
    window.dispatchEvent(new Event('hashchange'))
  </script>

  <template id="template-intro">
    <script type="module">
      import '@ulb-darmstadt/shacl-form/index.js'
    </script>
    <p>
      <a href="https://github.com/ULB-Darmstadt/shacl-form">&lt;shacl-form&gt;</a> is an HTML5 web component that takes <a href="https://www.w3.org/TR/shacl/">SHACL shapes</a> as input and generates an HTML form, allowing to enter data that conform to the given shapes.
      See the <a href="https://github.com/ULB-Darmstadt/shacl-form">README</a> for documentation of all element attributes, functions and supported input/output RDF formats.
      Basic usage example:
    </p>
    <pre>
        <code>
&lt;html&gt;
  &lt;head&gt;
      &lt;script src="https://cdn.jsdelivr.net/npm/@ulb-darmstadt/shacl-form/dist/index.js" type="module"&gt;&lt;/script&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;!-- SHACL shapes can be defined on the attribute 'data-shapes' or can be loaded by setting attribute 'data-shapes-url' --&gt;
    &lt;shacl-form data-shapes="
      @prefix sh: &lt;http://www.w3.org/ns/shacl#&gt; .
      @prefix ex: &lt;http://example.org#&gt; .

      ex:ExampleShape
        a sh:NodeShape ;
        sh:property [
          sh:name 'my value' ;
          sh:path ex:exampleValue ;
          sh:maxCount 3 ;
        ] .
    "&gt;&lt;/shacl-form&gt;

    &lt;script&gt;
      const form = document.querySelector("shacl-form")
      form.addEventListener('change', event => {
        // check if form validates according to the SHACL shapes
        if (event.detail?.valid) {
          // get data graph as RDF triples (default format is 'text/turtle') and log them to the browser console
          const triples = form.serialize() 
          console.log('entered form data', triples)
          // store the data somewhere, e.g. in a triple store
        }
      })
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
        </code>
    </pre>
    <fieldset style="max-width: 400px">
      <legend>Result of the above</legend>
      <shacl-form data-shapes="
        @prefix sh: <http://www.w3.org/ns/shacl#> .
        @prefix ex: <http://example.org#> .

        ex:ExampleShape
          a sh:NodeShape ;
          sh:property [
            sh:name 'my value' ;
            sh:path ex:exampleValue ;
            sh:maxCount 3 ;
          ] .
      "></shacl-form>

      <script>
        setTimeout(() => {
          const form = document.querySelector("shacl-form")
          form.addEventListener('change', event => {
            // check if form validates according to the SHACL shapes
            if (event.detail?.valid) {
              // get data graph as RDF triples and log them to the browser console
              const triples = form.serialize() 
              console.log('entered form data', triples)
              // store the data somewhere, e.g. in a triple store
            }
          })
        })
      </script>
    </fieldset>
  </template>

  <template id="template-datatypes">
    <p class="mb-1">
      <span class="code">sh:datatype</span>s are mapped to corresponding HTML input elements, including constraints like <span class="code">sh:minInclusive</span>, <span class="code">sh:minExclusive</span>, <span class="code">sh:maxInclusive</span>, <span class="code">sh:maxExclusive</span> and <span class="code">sh:pattern</span>.
      Note that you can affect the display order of the input elements with <span class="code">sh:order</span> or group elements using <span class="code">sh:group</span>.
    </p>
    <div class="wrapper">
      <fieldset><legend>SHACL shapes as input to the form</legend><pre id="shacl-shape-input"></pre></fieldset>
      <fieldset><legend>Generated form</legend><shacl-form id="shacl-form"></shacl-form></fieldset>
      <fieldset id="shacl-output"><legend>Output generated by the form</legend><pre></pre></fieldset>
    </div>
    <script>
      setTimeout(() => {
        const form = document.getElementById("shacl-form")
        const shapes = document.getElementById("shacl-shape-input")
        const output = document.getElementById("shacl-output")
        form.addEventListener('change', (ev) => {
          output.classList.toggle('valid', ev.detail?.valid)
          output.classList.toggle('invalid', !ev.detail?.valid)
          output.querySelector("pre").innerText = form.serialize()
        })
        fetch("datatypes.ttl").then(resp => resp.text()).then((text) => {
          shapes.innerText = text
          form.dataset['shapes'] = text
        })
      })
    </script>
  </template>
  
  <template id="template-complex-example">
    <p class="mb-1">This is a more complex example, demonstrating the advanced features of &lt;shacl-form&gt;. See below for an explanation.</p>
    <div class="wrapper">
      <fieldset><legend>SHACL shapes as input to the form</legend><pre id="shacl-shape-input"></pre></fieldset>
      <fieldset><legend>Data graph as input to the form</legend><pre id="shacl-data-input"></pre></fieldset>
      <fieldset><legend>Generated form</legend><shacl-form id="shacl-form" data-submit-button data-collapse="open" data-value-subject="http://example.org/4f2a8de3-9fc8-40a9-9237-d5964520ec54"></shacl-form></fieldset>
    </div>
    <fieldset id="shacl-output" class="mt-1"><legend>Output generated by the form</legend><pre></pre></fieldset>
    <script type="module">
      import { MapboxPlugin } from '@ulb-darmstadt/shacl-form/plugins/mapbox.js'
      
      setTimeout(async () => {
        const form = document.getElementById("shacl-form")
        form.registerPlugin(new MapboxPlugin({ datatype: 'http://www.opengis.net/ont/geosparql#wktLiteral' }, 'pk.eyJ1IjoiaHViZXJtb3NlciIsImEiOiJja3c2NDI2MXAwbWx0MnVudnJiOGV6NjRqIn0.va4IWkUk-USoL2Z8FylNzA'))

        const shapes = document.getElementById("shacl-shape-input")
        const data = document.getElementById("shacl-data-input")
        const output = document.getElementById("shacl-output")
        form.addEventListener('change', (ev) => {
          output.classList.toggle('valid', ev.detail?.valid)
          output.classList.toggle('invalid', !ev.detail?.valid)
          output.querySelector("pre").innerText = form.serialize()
        })
        form.addEventListener('submit', (ev) => {
          output.classList.add('valid')
          output.classList.remove('invalid')
          output.querySelector("pre").innerText = form.serialize()
        })
        form.setClassInstanceProvider((clazz) => { 
          if (clazz === 'http://example.org/Material') {
            return `
              <http://example.org/steel> a <http://example.org/Material>; <http://www.w3.org/2000/01/rdf-schema#label> "Steel".
              <http://example.org/wood> a <http://example.org/Material>; <http://www.w3.org/2000/01/rdf-schema#label> "Wood".
              <http://example.org/alloy> a <http://example.org/Material>; <http://www.w3.org/2000/01/rdf-schema#label> "Alloy".
              <http://example.org/plaster> a <http://example.org/Material>; <http://www.w3.org/2000/01/rdf-schema#label> "Plaster".
            `
          }
        })
        const shapesTTL = await fetch("complex-example.ttl").then(resp => resp.text())
        const dataTTL = await fetch("complex-example-data.ttl").then(resp => resp.text())
        shapes.innerText = shapesTTL
        data.innerText = dataTTL
        form.dataset['shapes'] = shapesTTL
        form.dataset['values'] = dataTTL
      })
    </script>
    <p class="mt-1">The example above uses the following features:</p>
    <h2>SHACL shape inheritance</h2>
    <p>
      SHACL defines two ways of extending or inheriting shapes: <a href="https://www.w3.org/TR/shacl/#AndConstraintComponent"><span class="code">sh:and</span></a>
      and <a href="https://www.w3.org/TR/shacl/#NodeConstraintComponent"><span class="code">sh:node</span></a>. Both are supported. In this example, node shape
      <span class="code">example:ArchitectureModelDataset</span> extends <span class="code">example:Dataset</span> by defining this RDF triple:
    </p>
    <pre><span class="code">example:ArchitectureModelDataset sh:node example:Dataset</span></pre>
    <h2>Providing additional data to the shapes graph</h2>
    <p>
      Apart from setting the element attributes <span class="code">data-shapes</span> or <span class="code">data-shapes-url</span>, there are two ways of adding RDF data to the shapes graph:
    </p>
    <ul>
      <li><p>
        While parsing the triples of the shapes graph, any encountered <span class="code">owl:imports</span> statement that has a valid URL value will be tried to fetch with the HTTP Accept header set to all of the supported RDF serialization formats.
        A successful response will be parsed and added to the shapes graph. The example shapes graph contains the following triple:<br>
        <span class="code">example:Attribution owl:imports &lt;https://w3id.org/nfdi4ing/metadata4ing/&gt;</span><br>
        to load an external taxonomy which defines instances of class <span class="code">prov:Role</span> that will be listed in the role dropdown of attributions
      </p></li>
      <li><p>
        The &lt;shacl-form&gt; element has a function <span class="code">setClassInstanceProvider((className: string) => Promise&lt;string&gt;)</span> that sets a callback function that is called when a SHACL property has
        an <span class="code">sh:class</span> definition. The expected return value is a string (e.g. in format <span class="code">text/turtle</span>) that contains RDF class instance definitions of the given class. Instances can be defined e.g. like:
        </p>
        <ul><li><p><span class="code">example:Instance a example:Class</span></p></li>
        <li><p><span class="code">example:Instance a owl:NamedIndividual; skos:broader example:Class</span></p></li>
        </ul>
        
        <p>Class hierarchies can be built using <span class="code">rdfs:subClassOf</span> or <span class="code">skos:broader</span>. In this example, the code:</p>
        <pre><code>
form.setClassInstanceProvider((clazz) => { 
  if (clazz === 'http://example.org/Material') {
    return `
      &lt;http://example.org/steel&gt;   a &lt;http://example.org/Material&gt;; &lt;http://www.w3.org/2000/01/rdf-schema#label&gt; "Steel".
      &lt;http://example.org/wood&gt;    a &lt;http://example.org/Material&gt;; &lt;http://www.w3.org/2000/01/rdf-schema#label&gt; "Wood".
      &lt;http://example.org/alloy&gt;   a &lt;http://example.org/Material&gt;; &lt;http://www.w3.org/2000/01/rdf-schema#label&gt; "Alloy".
      &lt;http://example.org/plaster&gt; a &lt;http://example.org/Material&gt;; &lt;http://www.w3.org/2000/01/rdf-schema#label&gt; "Plaster".
    `
  }
          </code></pre>
        <p>
          returns instances of the class <span class="code">http://example.org/Material</span> that are then used to populate the artwork material dropdown in the form.
          A more realistic use case is calling an API to fetch class instance definitions from existing ontologies.
        </p>
      </li>
    </ul>
    <h2>Binding a data graph</h2>
    <p></p>
    <h2>SHACL "or" constraint</h2>
    <p>
      &lt;shacl-form&gt; supports using the <a href="https://www.w3.org/TR/shacl/#OrConstraintComponent"><span class="code">sh:or</span></a> constraint to let users select between different options on nodes or properties.
      In the example above, the node shape <span class="code">example:Attribution</span> defines a property with <span class="code">sh:path prov:agent</span>,
      whose values either conform to node shape <span class="code">example:Person</span> or <span class="code">example:Organisation</span>. After selecting one of the options, the respective input fields are added to the form.
    </p>
    <p>When binding an existing data graph to the form, the <span class="code">sh:or</span></a> constraint is tried to be resolved depending on the respective data value:</p>
    <ul>
      <li><p class="my-0">For RDF literals, an <span class="code">sh:or</span> option with a matching <span class="code">sh:datatype</span> is chosen</p></li>
      <li><p class="my-0">For blank nodes or named nodes, the <span class="code">rdf:type</span> of the value is tried to be matched with a node shape having a corresponding <span class="code">sh:targetClass</span> or with a property shape having a corresponding <span class="code">sh:class</span></p></li>
    </ul>
    <h2>Plugins</h2>
    <p>Plugins can modify rendering of the form and add functionality to edit and view certain RDF datatypes or predicates (or a combination of both). As an example, the JavaScript of this page contains the following code:</p>
    <pre><code>
import { MapboxPlugin } from '@ulb-darmstadt/shacl-form/plugins/mapbox.js'
const form = document.getElementById("shacl-form")
form.registerPlugin(new MapboxPlugin({ datatype: 'http://www.opengis.net/ont/geosparql#wktLiteral' }, API_KEY))
    </code></pre>
    <p>
      In effect, whenever a SHACL property has a <span class="code">sh:datatype</span> of <span class="code">http://www.opengis.net/ont/geosparql#wktLiteral</span>, the plugin is called to create the editor and/or viewer HTML elements.
      This specific plugin uses <a href="https://docs.mapbox.com/mapbox-gl-js/guides/">Mapbox GL</a> to edit or view geometry in <a href="http://giswiki.org/wiki/Well_Known_Text">well known text</a> format on a map.
    </p>
    <h2>Grouping and collapsing properties</h2>
    <p></p>

  </template>

  <template id="template-viewer-mode">
    <p class="mb-1">Same as <a href="#complex-example">complex example</a>, but with attribute <span class="code">data-mode="view"</span> on the &lt;shacl-form&gt; element.</p>
    <div class="wrapper">
      <fieldset><legend>SHACL shapes as input to the viewer</legend><pre id="shacl-shape-input"></pre></fieldset>
      <fieldset><legend>Data graph as input to the viewer</legend><pre id="shacl-data-input"></pre></fieldset>
      <fieldset><legend>Generated viewer</legend><shacl-form id="shacl-form" data-collapse="open" data-mode="view" data-value-subject="http://example.org/4f2a8de3-9fc8-40a9-9237-d5964520ec54"></shacl-form></fieldset>
    </div>
    <script type="module">
      import { MapboxPlugin } from '@ulb-darmstadt/shacl-form/plugins/mapbox.js'
      
      setTimeout(async () => {
        const form = document.getElementById("shacl-form")
        form.registerPlugin(new MapboxPlugin({ datatype: 'http://www.opengis.net/ont/geosparql#wktLiteral' }, 'pk.eyJ1IjoiaHViZXJtb3NlciIsImEiOiJja3c2NDI2MXAwbWx0MnVudnJiOGV6NjRqIn0.va4IWkUk-USoL2Z8FylNzA'))

        const shapes = document.getElementById("shacl-shape-input")
        const data = document.getElementById("shacl-data-input")
        form.setClassInstanceProvider((clazz) => { 
          if (clazz === 'http://example.org/Material') {
            return `
              <http://example.org/steel> a <http://example.org/Material>; <http://www.w3.org/2000/01/rdf-schema#label> "Steel".
              <http://example.org/wood> a <http://example.org/Material>; <http://www.w3.org/2000/01/rdf-schema#label> "Wood".
              <http://example.org/alloy> a <http://example.org/Material>; <http://www.w3.org/2000/01/rdf-schema#label> "Alloy".
              <http://example.org/plaster> a <http://example.org/Material>; <http://www.w3.org/2000/01/rdf-schema#label> "Plaster".
            `
          }
        })
        const shapesTTL = await fetch("complex-example.ttl").then(resp => resp.text())
        const dataTTL = await fetch("complex-example-data.ttl").then(resp => resp.text())
        shapes.innerText = shapesTTL
        data.innerText = dataTTL
        form.dataset['shapes'] = shapesTTL
        form.dataset['values'] = dataTTL
      })
    </script>
  </template>

  <template id="template-theming">
    <div class="wrapper">
      <fieldset><legend>Default</legend><iframe src="theme-default.html"></iframe></fieldset>
      <fieldset><legend>Material design [alpha status]</legend><iframe src="theme-material.html"></iframe></fieldset>
      <fieldset><legend>Bootstrap [alpha status]</legend><iframe src="theme-bootstrap.html"></iframe></fieldset>
    </div>
  </template>

  <template id="template-try-your-own">
    <div class="wrapper">
      <fieldset><legend>Enter your SHACL shapes here</legend><textarea id="shacl-shape-input" class="w-100 h-100"></textarea></fieldset>
      <fieldset><legend>Generated form</legend><shacl-form id="shacl-form"></shacl-form></fieldset>
      <fieldset id="shacl-output"><legend>Output generated by the form</legend><pre></pre></fieldset>
    </div>
    <script>
      setTimeout(() => {
        const form = document.getElementById("shacl-form")
        const shapes = document.getElementById("shacl-shape-input")
        const output = document.getElementById("shacl-output")
        shapes.addEventListener('change', () => {
          form.dataset['shapes'] = shapes.value
          output.querySelector("pre").innerText = ''
          output.classList.remove('valid', 'invalid')
        })
        form.addEventListener('change', (ev) => {
          output.classList.toggle('valid', ev.detail?.valid)
          output.classList.toggle('invalid', !ev.detail?.valid)
          output.querySelector("pre").innerText = form.serialize()
        })
        shapes.focus()
      })
    </script>
  </template>
</body>
</html>
